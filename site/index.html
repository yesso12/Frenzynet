<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FrenzyNets | Watch Party</title>
  <meta name="description" content="FrenzyNets Watch Party platform with rooms, major-night hosting, admin controls, and desktop panel downloads." />
  <style>
    :root {
      --bg:#070f1f;
      --bg2:#0c1730;
      --panel:#121f3a;
      --line:#294878;
      --text:#ecf3ff;
      --muted:#9ab2d8;
      --accent:#36d6ff;
      --accent2:#00b9f2;
      --ok:#76f2bb;
      --warn:#ffd166;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family:"Segoe UI",Tahoma,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 12% 12%, rgba(54,214,255,.22), transparent 35%),
        radial-gradient(circle at 88% 8%, rgba(90,130,255,.18), transparent 32%),
        linear-gradient(155deg, var(--bg), var(--bg2));
      min-height:100vh;
    }
    .shell { width:min(1180px, calc(100% - 24px)); margin:14px auto 28px; }
    .top {
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(10,20,38,.82);
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .brand { font-size:1.15rem; font-weight:800; letter-spacing:.04em; }
    .nav { display:flex; gap:8px; flex-wrap:wrap; }
    .btn {
      display:inline-block;
      border:1px solid #4e78ad;
      border-radius:10px;
      padding:10px 13px;
      text-decoration:none;
      font-weight:700;
      color:#051322;
      background:linear-gradient(135deg, var(--accent), var(--accent2));
    }
    .btn.alt {
      color:var(--text);
      background:linear-gradient(140deg, #16305a, #173258);
      border-color:#3c5f8f;
    }
    .hero {
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:linear-gradient(145deg, rgba(18,31,58,.95), rgba(10,19,38,.95));
      padding:18px;
    }
    h1 { margin:0 0 8px; font-size:clamp(1.55rem, 4vw, 2.4rem); }
    p { margin:0 0 10px; color:var(--muted); }
    .grid { display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:10px; margin-top:10px; }
    .card {
      border:1px solid var(--line);
      border-radius:12px;
      background:linear-gradient(150deg, rgba(19,35,63,.96), rgba(11,21,41,.95));
      padding:12px;
    }
    .card h3 { margin:0 0 8px; font-size:1rem; }
    .card p { margin:0 0 10px; font-size:.95rem; }
    .row { display:flex; gap:8px; flex-wrap:wrap; }
    .rooms { display:grid; grid-template-columns:repeat(5,minmax(0,1fr)); gap:8px; margin-top:8px; }
    .room {
      border:1px solid #4c70a5;
      border-radius:10px;
      background:linear-gradient(150deg, rgba(23,39,68,.95), rgba(13,24,45,.95));
      color:var(--text);
      text-decoration:none;
      padding:10px;
      font-weight:700;
      font-size:.9rem;
    }
    .meta { color:var(--ok); font-size:.82rem; margin-top:4px; }
    .verify {
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:rgba(11,21,41,.92);
      padding:12px;
    }
    pre {
      margin:8px 0;
      border:1px solid #365782;
      border-radius:10px;
      background:#0a172f;
      color:#d9e8ff;
      padding:10px;
      overflow:auto;
      font-size:.9rem;
    }
    .tag { display:inline-block; border:1px solid #41689a; border-radius:999px; padding:4px 8px; font-size:.78rem; color:#c7ddff; }
    .hidden { display:none !important; }
    details {
      border:1px solid #355782;
      border-radius:10px;
      padding:10px;
      background:rgba(13,25,47,.92);
      margin-bottom:8px;
    }
    summary { cursor:pointer; font-weight:700; color:#d8e9ff; }
    .request-item {
      border:1px solid #395d8b;
      border-radius:10px;
      background:rgba(11,20,38,.9);
      padding:8px;
      margin-top:8px;
      font-size:.9rem;
    }
    .kpi-grid { display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:8px; margin-top:8px; }
    .kpi {
      border:1px solid #3d5f8f;
      border-radius:10px;
      background:rgba(12,24,45,.9);
      padding:8px;
    }
    .kpi .n { font-weight:800; font-size:1.1rem; color:#e7f4ff; }
    .kpi .k { font-size:.76rem; color:var(--muted); text-transform:uppercase; letter-spacing:.04em; }
    .spotlight {
      border:1px solid #3b6192;
      border-radius:10px;
      background:linear-gradient(145deg, rgba(17,33,60,.95), rgba(12,23,44,.95));
      padding:10px;
      margin-top:8px;
    }
    .room-tools { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    @media (max-width: 980px) {
      .grid { grid-template-columns:1fr; }
      .rooms { grid-template-columns:repeat(2,minmax(0,1fr)); }
      .kpi-grid { grid-template-columns:repeat(2,minmax(0,1fr)); }
    }
    @media (max-width: 640px) {
      .shell { width:calc(100% - 16px); }
      .rooms { grid-template-columns:1fr; }
      .btn { width:100%; text-align:center; }
      .row .btn { width:auto; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="top">
      <div class="brand">FrenzyNets Watch Party</div>
      <div class="nav">
        <a class="btn" href="/telewatch/">Watch Party</a>
        <a class="btn" href="/telewatch/?mainEvent=1">Join Main Event</a>
        <a class="btn alt admin-only hidden" href="/telewatch/admin/">Admin Panel</a>
        <a class="btn alt admin-only hidden" href="/frenzynet-updates/">Desktop Downloads</a>
        <a class="btn alt" href="https://discord.gg/4uRUSAN498" target="_blank" rel="noopener">Discord</a>
      </div>
    </div>

    <section class="hero">
      <span class="tag">Watch Party Only</span>
      <h1>Host Major Movie Nights From One Place</h1>
      <p>No VPN content on this page. FrenzyNets is now focused on Watch Party hosting, room controls, admin tools, and desktop panel downloads.</p>
      <div class="row">
        <a class="btn" href="/telewatch/">Open Watch Party</a>
        <a class="btn" href="/telewatch/?mainEvent=1">Join Main Event (Public)</a>
        <a class="btn alt" href="/telewatch/?mode=public">Browse Public Rooms</a>
        <a class="btn alt admin-only hidden" href="/telewatch/?admin=1">Main Event Mode</a>
        <a class="btn alt admin-only hidden" href="/telewatch/admin/">Room Moderation</a>
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <h3>Join By Room Code</h3>
        <p>Enter a room code and jump directly into a watch room.</p>
        <div class="row">
          <input id="roomCode" type="text" placeholder="Room code" maxlength="12" style="flex:1;min-width:160px;border:1px solid #3d5f90;background:#0a1830;color:#ecf3ff;border-radius:10px;padding:10px;" />
          <a id="joinBtn" class="btn" href="/telewatch/">Join Room</a>
        </div>
      </article>

      <article class="card admin-only hidden">
        <h3>Desktop App (All PC Types)</h3>
        <p>Watch Party desktop panel downloads for x64, x86, and ARM64.</p>
        <div class="row">
          <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip">x64</a>
          <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x86.zip">x86</a>
          <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-arm64.zip">ARM64</a>
        </div>
      </article>

      <article class="card admin-only hidden">
        <h3>Admin / Owner Tools</h3>
        <p>Moderate rooms, run main event nights, and manage live sessions.</p>
        <div class="row">
          <a class="btn alt" href="/telewatch/admin/">Open Admin</a>
          <a class="btn alt" href="/telewatch/?admin=1">Main Event Controls</a>
          <a class="btn alt" href="/frenzynet-updates/">Updates Panel</a>
        </div>
      </article>
    </section>

    <section class="card" style="margin-top:10px">
      <h3>Main Event Access</h3>
      <p>When a major night is hosted, this public button jumps straight to it.</p>
      <div class="row">
        <a class="btn" href="/telewatch/?mainEvent=1">Join Main Event Now</a>
      </div>
      <div class="spotlight">
        <div style="font-weight:700;color:#d9ecff">Event Spotlight</div>
        <div id="spotlightText" class="meta">Loading event highlights...</div>
      </div>
    </section>

    <section class="card" style="margin-top:10px">
      <h3>Open Rooms</h3>
      <p>Quick room links for active public watch party rooms.</p>
      <div class="room-tools">
        <input id="roomFilter" type="text" placeholder="Filter room code..." maxlength="12" style="flex:1;min-width:170px;border:1px solid #3d5f90;background:#0a1830;color:#ecf3ff;border-radius:10px;padding:9px;" />
        <button id="randomRoomBtn" class="btn" type="button">Join Random Room</button>
      </div>
      <div id="rooms" class="rooms"></div>
      <div class="kpi-grid">
        <div class="kpi"><div id="kpiRooms" class="n">0</div><div class="k">Open Rooms</div></div>
        <div class="kpi"><div id="kpiLive" class="n">0</div><div class="k">Live Rooms</div></div>
        <div class="kpi"><div id="kpiWatchers" class="n">0</div><div class="k">Watchers</div></div>
        <div class="kpi"><div id="kpiUpdated" class="n">--</div><div class="k">Updated</div></div>
      </div>
    </section>

    <section class="card" style="margin-top:10px">
      <h3>Live Interactions</h3>
      <p>Public users can post requests for upcoming watch nights.</p>
      <div class="row">
        <input id="requestText" type="text" placeholder="Request a movie or event..." maxlength="120" style="flex:1;min-width:220px;border:1px solid #3d5f90;background:#0a1830;color:#ecf3ff;border-radius:10px;padding:10px;" />
        <button id="requestBtn" class="btn" type="button">Submit Request</button>
      </div>
      <div id="requestList"></div>
      <div style="margin-top:10px" class="meta">Next major night countdown: <span id="countdown">loading...</span></div>
      <div class="row" style="margin-top:10px">
        <button id="reactHype" class="btn" type="button">ðŸ”¥ Hype</button>
        <button id="reactReady" class="btn" type="button">âœ… Ready</button>
        <button id="reactInvite" class="btn" type="button">ðŸ“£ Invite Friends</button>
      </div>
      <div id="reactionBoard" class="meta"></div>
    </section>

    <section class="card" style="margin-top:10px">
      <h3>Community Voting</h3>
      <p>All official polls and voting now happen in Discord only.</p>
      <div class="row">
        <a class="btn" href="https://discord.gg/4uRUSAN498" target="_blank" rel="noopener">Open Discord Voting</a>
      </div>
    </section>

    <section class="card" style="margin-top:10px">
      <h3>How It Works</h3>
      <details>
        <summary>How do I join a watch party?</summary>
        <p>Use a room code from your host, enter it above, then join from the Watch Party page.</p>
      </details>
      <details>
        <summary>Do I need the desktop app to watch?</summary>
        <p>No. Public users can join from web. Desktop panel is currently admin-only.</p>
      </details>
      <details>
        <summary>Where do I report issues during events?</summary>
        <p>Use the FrenzyNets Discord support channel while the event is live.</p>
      </details>
    </section>

    <section class="verify admin-only hidden">
      <h3 style="margin:0 0 6px">Verify Desktop Download</h3>
      <pre>Get-FileHash .\FrenzyWatchPartyPanel-win-x64.zip -Algorithm SHA256
# Compare with /frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip.sha256</pre>
      <div class="row">
        <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip.sha256">x64 SHA256</a>
        <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x86.zip.sha256">x86 SHA256</a>
        <a class="btn alt" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-arm64.zip.sha256">ARM64 SHA256</a>
      </div>
    </section>
  </div>

  <script>
    (function() {
      const input = document.getElementById('roomCode');
      const joinBtn = document.getElementById('joinBtn');
      const roomsEl = document.getElementById('rooms');
      const requestInput = document.getElementById('requestText');
      const requestBtn = document.getElementById('requestBtn');
      const requestList = document.getElementById('requestList');
      const countdown = document.getElementById('countdown');
      const roomFilter = document.getElementById('roomFilter');
      const randomRoomBtn = document.getElementById('randomRoomBtn');
      const kpiRooms = document.getElementById('kpiRooms');
      const kpiLive = document.getElementById('kpiLive');
      const kpiWatchers = document.getElementById('kpiWatchers');
      const kpiUpdated = document.getElementById('kpiUpdated');
      const spotlightText = document.getElementById('spotlightText');
      const reactionBoard = document.getElementById('reactionBoard');
      const isAdmin = !!localStorage.getItem('fn_admin_token');
      document.querySelectorAll('.admin-only').forEach((el) => {
        if (isAdmin) el.classList.remove('hidden');
      });
      let roomCache = [];

      function cleanCode(v) {
        return String(v || '').toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 12);
      }

      function syncJoin() {
        const code = cleanCode(input.value);
        input.value = code;
        joinBtn.href = code ? `/telewatch/?room=${encodeURIComponent(code)}` : '/telewatch/';
      }

      input.addEventListener('input', syncJoin);
      syncJoin();

      const fallback = Array.from({ length: 10 }, (_, i) => {
        const code = `WATCH${String(i + 1).padStart(2, '0')}`;
        return { roomCode: code, title: `Public Room ${String(i + 1).padStart(2, '0')}`, activeCount: 0, isLive: false, joinUrl: `/telewatch/?room=${code}` };
      });

      function updateKpis(rooms) {
        const rows = rooms || [];
        const live = rows.filter((r) => !!r.isLive).length;
        const watchers = rows.reduce((n, r) => n + Number(r.activeCount || 0), 0);
        kpiRooms.textContent = String(rows.length);
        kpiLive.textContent = String(live);
        kpiWatchers.textContent = String(watchers);
        const d = new Date();
        kpiUpdated.textContent = d.getHours().toString().padStart(2, '0') + ':' + d.getMinutes().toString().padStart(2, '0');
      }

      function draw(rooms) {
        roomCache = Array.isArray(rooms) ? rooms.slice() : [];
        const q = String(roomFilter.value || '').toUpperCase().trim();
        const filtered = !q ? roomCache : roomCache.filter((r) => String(r.roomCode || '').toUpperCase().includes(q));
        roomsEl.innerHTML = (rooms || []).slice(0, 10).map((r) => {
          const code = String(r.roomCode || '').toUpperCase();
          const viewers = Number(r.activeCount || 0);
          const state = r.isLive ? `LIVE Â· ${viewers} watching` : 'Open';
          const href = r.joinUrl || `/telewatch/?room=${encodeURIComponent(code)}`;
          return `<a class="room" href="${href}">${code}<div class="meta">${state}</div></a>`;
        }).join('');
        if (q) {
          roomsEl.innerHTML = filtered.slice(0, 10).map((r) => {
            const code = String(r.roomCode || '').toUpperCase();
            const viewers = Number(r.activeCount || 0);
            const state = r.isLive ? `LIVE Â· ${viewers} watching` : 'Open';
            const href = r.joinUrl || `/telewatch/?room=${encodeURIComponent(code)}`;
            return `<a class="room" href="${href}">${code}<div class="meta">${state}</div></a>`;
          }).join('') || '<div class="meta">No rooms match your filter.</div>';
        }
        updateKpis(roomCache);
      }

      draw(fallback);

      fetch('https://api.frenzynets.com/api/telewatch/public-rooms', { cache: 'no-store' })
        .then((r) => r.ok ? r.json() : null)
        .then((j) => {
          if (j && Array.isArray(j.rooms) && j.rooms.length) draw(j.rooms);
        })
        .catch(() => {});
      roomFilter.addEventListener('input', () => draw(roomCache.length ? roomCache : fallback));
      randomRoomBtn.addEventListener('click', () => {
        const rows = roomCache.length ? roomCache : fallback;
        const pick = rows[Math.floor(Math.random() * rows.length)];
        if (!pick) return;
        const code = String(pick.roomCode || '').toUpperCase();
        window.location.href = `/telewatch/?room=${encodeURIComponent(code)}`;
      });

      function readRequests() {
        try { return JSON.parse(localStorage.getItem('fn_public_requests') || '[]'); } catch (_) { return []; }
      }
      function writeRequests(rows) {
        try { localStorage.setItem('fn_public_requests', JSON.stringify(rows.slice(0, 25))); } catch (_) {}
      }
      function renderRequests() {
        const rows = readRequests();
        requestList.innerHTML = rows.length ? rows.map((r) => `<div class="request-item">${r}</div>`).join('') : '<div class="meta">No requests yet.</div>';
      }
      requestBtn.addEventListener('click', () => {
        const v = String(requestInput.value || '').trim();
        if (!v) return;
        const rows = readRequests();
        rows.unshift(v);
        writeRequests(rows);
        requestInput.value = '';
        renderRequests();
      });
      renderRequests();

      function fallbackNextSaturdayMs() {
        const now = new Date();
        const target = new Date(now.getTime());
        const days = (6 - target.getDay() + 7) % 7;
        target.setDate(target.getDate() + days);
        target.setHours(20, 0, 0, 0);
        if (target.getTime() <= now.getTime()) target.setDate(target.getDate() + 7);
        return target.getTime();
      }
      let nextEvent = fallbackNextSaturdayMs();
      function tickCountdown() {
        const diff = nextEvent - Date.now();
        if (diff <= 0) {
          countdown.textContent = 'LIVE now';
          return;
        }
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        countdown.textContent = `${d}d ${h}h ${m}m`;
      }
      tickCountdown();
      setInterval(tickCountdown, 15000);
      fetch('https://api.frenzynets.com/api/telewatch/public-settings', { cache: 'no-store' })
        .then((r) => r.ok ? r.json() : null)
        .then((j) => {
          const iso = j && j.settings ? String(j.settings.mainEventCountdownIso || '') : '';
          const ms = Date.parse(iso);
          if (Number.isFinite(ms) && ms > 0) {
            nextEvent = ms;
            tickCountdown();
          }
        })
        .catch(() => {});

      const spotlightItems = [
        'Main Event public lobby opens 15 minutes before showtime.',
        'Hosts can enable invite-only rooms for private groups.',
        'Public viewers can jump straight in with the Main Event button.',
        'Live room list auto-updates as new parties open.'
      ];
      let sIdx = 0;
      function rotateSpotlight() {
        spotlightText.textContent = spotlightItems[sIdx % spotlightItems.length];
        sIdx += 1;
      }
      rotateSpotlight();
      setInterval(rotateSpotlight, 6000);

      function readReactions() {
        try { return JSON.parse(localStorage.getItem('fn_public_reactions') || '{"hype":0,"ready":0,"invite":0}'); } catch (_) { return { hype:0, ready:0, invite:0 }; }
      }
      function writeReactions(v) {
        try { localStorage.setItem('fn_public_reactions', JSON.stringify(v)); } catch (_) {}
      }
      function renderReactions() {
        const r = readReactions();
        reactionBoard.textContent = `ðŸ”¥ Hype: ${r.hype}  |  âœ… Ready: ${r.ready}  |  ðŸ“£ Invite Friends: ${r.invite}`;
      }
      document.getElementById('reactHype').addEventListener('click', () => { const r = readReactions(); r.hype += 1; writeReactions(r); renderReactions(); });
      document.getElementById('reactReady').addEventListener('click', () => { const r = readReactions(); r.ready += 1; writeReactions(r); renderReactions(); });
      document.getElementById('reactInvite').addEventListener('click', () => { const r = readReactions(); r.invite += 1; writeReactions(r); renderReactions(); });
      renderReactions();

    })();
  </script>
</body>
</html>
