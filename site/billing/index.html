<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>FrenzyNet - Secure Checkout</title>
  <style>
    :root { --bg-a:#061128; --bg-b:#0f1f4a; --card:#122658; --line:#2d4685; --text:#eef5ff; --muted:#9fb4dc; --cyan:#35e8ff; --green:#22d489; --warn:#ffd166; --err:#ff6b87; }
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);font-family:"Segoe UI","Bahnschrift",system-ui,sans-serif;background:radial-gradient(1100px 700px at -10% -10%, #1a3a6d 0%, transparent 58%),radial-gradient(1300px 800px at 105% -15%, #173665 0%, transparent 55%),linear-gradient(160deg,var(--bg-a),var(--bg-b));min-height:100vh}
    .wrap{width:min(1180px,calc(100% - 28px));margin:26px auto 34px}
    .hero{border:1px solid var(--line);border-radius:20px;background:linear-gradient(140deg,rgba(18,38,88,.9),rgba(10,22,54,.95));padding:22px;box-shadow:0 18px 42px rgba(0,0,0,.34)}
    .brand{color:var(--cyan);font-size:14px;font-weight:800;letter-spacing:.9px}
    h1{margin:7px 0 6px;font-size:clamp(28px,4vw,46px)}
    .sub{margin:0;color:var(--muted)}
    .grid{margin-top:14px;display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
    .panel{grid-column:span 6;border:1px solid var(--line);border-radius:16px;background:linear-gradient(180deg,#112455,#0f204d);padding:16px}
    @media (max-width:980px){.panel{grid-column:span 12}}
    .label{display:block;margin:0 0 6px;color:var(--muted);font-size:12px}
    .row{margin-bottom:10px}
    input{width:100%;padding:10px 11px;border-radius:10px;border:1px solid #2e4b90;background:#0b173b;color:#eaf5ff;outline:none}
    input:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(53,232,255,.14)}
    .cards{display:grid;grid-template-columns:repeat(3,minmax(170px,1fr));gap:10px;margin-top:8px}
    @media (max-width:760px){.cards{grid-template-columns:1fr}}
    .card{border:1px solid #345293;background:linear-gradient(180deg,var(--card),#10224f);border-radius:14px;padding:13px}
    .card.sel{border-color:var(--cyan);box-shadow:0 0 0 2px rgba(53,232,255,.2)}
    .tag{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px}
    .name{font-size:20px;font-weight:700;margin-top:5px}
    .price{font-size:30px;font-weight:800;margin-top:6px}
    .intv{font-size:12px;color:var(--muted)}
    .choose{margin-top:11px;width:100%;padding:9px 10px;border-radius:10px;border:1px solid #3a5da7;background:#15306b;color:#ecf6ff;font-weight:700;cursor:pointer}
    .addon{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;border:1px solid #2f4a8a;background:linear-gradient(180deg,#112350,#0f1f47);border-radius:12px;padding:10px;margin-bottom:8px}
    .addon small{display:block;color:var(--muted)}
    .addon-tools{display:flex;gap:8px;flex-wrap:wrap;margin:0 0 10px}
    .addon-tools button{padding:7px 10px;border-radius:9px;border:1px solid #3a5da7;background:#15306b;color:#ecf6ff;font-weight:700;cursor:pointer}
    .qty{width:74px;padding:7px 8px;border-radius:8px;border:1px solid #3f5ca0;background:#12295f;color:#f0f8ff}
    .btn{border:0;border-radius:11px;padding:11px 13px;font-weight:800;cursor:pointer;transition:transform .12s ease,filter .16s ease}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .btn:disabled{opacity:.55;cursor:not-allowed;transform:none}
    .btn-stripe{background:linear-gradient(90deg,var(--cyan),#2fb8ff);color:#081a37;width:100%}
    .btn-cash{background:linear-gradient(90deg,var(--green),#42ecad);color:#032f21;width:100%;margin-top:8px}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:560px){.split{grid-template-columns:1fr}}
    .status{min-height:20px;margin-top:8px;color:var(--warn);font-size:13px}
    .status.ok{color:#67f4b0}.status.err{color:var(--err)}
    .muted{font-size:12px;color:var(--muted)}
    .total{margin-top:10px;padding:10px 11px;border-radius:10px;background:#0a183a;border:1px solid #2a4279;font-weight:700}
    .trust-grid{margin-top:14px;display:grid;grid-template-columns:repeat(2,minmax(260px,1fr));gap:12px}
    @media (max-width:760px){.trust-grid{grid-template-columns:1fr}}
    .trust-card{border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,#10224f,#0d1d45);padding:12px}
    .trust-card h4{margin:0 0 8px;color:#dff4ff}
    .trust-card ul{margin:0;padding-left:18px;color:var(--muted)}
    .release-note{font-size:12px;color:var(--muted);line-height:1.45}
    .site-banner{display:none;margin:0 0 12px;padding:10px 12px;border-radius:12px;border:1px solid #3a5da7;background:#10224f}
    .site-banner.warn{display:block;border-color:#ffd166;background:linear-gradient(145deg, rgba(74,50,16,.92), rgba(36,24,9,.92))}
    .site-banner.err{display:block;border-color:#ff6f87;background:linear-gradient(145deg, rgba(80,20,47,.92), rgba(35,11,30,.92))}
    .assist{margin-top:10px;border:1px solid #2f4a8a;background:#0d1f48;border-radius:12px;padding:10px}
    .assist h4{margin:0 0 6px}
    .mini{font-size:12px;color:var(--muted)}
    .warn-note{margin-top:8px;color:#ffd166;font-size:12px}
    .wizard-steps{margin:8px 0 0;padding-left:18px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="incidentBanner" class="site-banner err"></div>
    <div id="promoBanner" class="site-banner warn"></div>
    <section class="hero">
      <div class="brand">FRENZYNET CHECKOUT</div>
      <h1 id="heroTitle">Create Account + Start Subscription</h1>
      <p id="heroSub" class="sub">Stripe hosted checkout with optional add-ons. FrenzyNet auto-enables all available Stripe payment methods for your account and region.</p>

      <div class="grid">
        <div class="panel">
          <h3 style="margin:0 0 10px">1) Choose Plan</h3>
          <div id="planCards" class="cards"></div>
          <h3 style="margin:14px 0 10px">Optional Add-ons</h3>
          <div class="addon-tools">
            <button type="button" id="addonPackCompetitive">Competitive Pack</button>
            <button type="button" id="addonPackPremium">Premium Pack</button>
            <button type="button" id="addonPackCreator">Creator Pack</button>
            <button type="button" id="addonPackStreaming">Streaming Shield Pack</button>
            <button type="button" id="addonPackClear">Clear Add-ons</button>
          </div>
          <div id="addonList"></div>
          <div id="orderTotal" class="total">Total: --</div>
          <div id="planState" class="status"></div>
        </div>

        <div class="panel">
          <h3 style="margin:0 0 10px">2) Create FrenzyNet Account</h3>
          <div class="row">
            <label class="label" for="suUser">Username</label>
            <input id="suUser" autocomplete="username" placeholder="yourusername" />
          </div>
          <div class="row split">
            <div>
              <label class="label" for="suPass">Password</label>
              <input id="suPass" type="password" autocomplete="new-password" placeholder="minimum 8 chars" />
            </div>
            <div>
              <label class="label" for="suPass2">Confirm Password</label>
              <input id="suPass2" type="password" autocomplete="new-password" />
            </div>
          </div>
          <button id="signupStripeBtn" data-track="checkout_stripe_click" class="btn btn-stripe">Create Account + Pay With Stripe</button>
          <button id="signupCashBtn" data-track="checkout_cashapp_click" class="btn btn-cash">Create Account + Request Cash App Review</button>
          <div class="row" style="margin-top:8px">
            <input id="promoCode" placeholder="Promo code (optional)" />
            <button id="genPromoLink" class="btn" style="width:auto;background:#15306b;color:#ecf6ff">Generate Promo Link</button>
          </div>
          <div id="paymentOptions" class="muted" style="margin-top:8px"></div>
          <div id="signupState" class="status"></div>
          <div class="muted">Add-ons are applied in Stripe checkout. Cash App requests are submitted for manual approval by FrenzyNet.</div>
          <div class="warn-note">Ad-block add-on runs in strict mode, but no VPN/DNS method can guarantee 100% blocking on every platform or app.</div>
          <div class="assist">
            <h4>Recommended Node</h4>
            <div id="geoRec" class="mini">Detecting best region...</div>
          </div>
          <div class="assist">
            <h4>Recovery Assist</h4>
            <div id="recoveryAssist" class="mini">No unfinished checkout detected.</div>
          </div>
          <div class="assist">
            <h4>Onboarding Wizard</h4>
            <ol class="wizard-steps">
              <li>Install FrenzyNet and open the client.</li>
              <li>Run dependency check (.NET, WireGuard, permissions).</li>
              <li>Login and pick your first profile preset.</li>
              <li>Quick Connect and run latency test.</li>
              <li>Open a support ticket from the app if needed.</li>
            </ol>
            <div class="mini" style="margin-top:8px"><a href="/setup/" style="color:#35e8ff">Open full setup/download checklist</a></div>
          </div>
        </div>
      </div>

      <div class="trust-grid">
        <div class="trust-card">
          <h4>Trust & Security</h4>
          <ul>
            <li id="trustLineA">Hosted Stripe checkout for secure card and wallet processing.</li>
            <li id="trustLineB">Cash App requests are manually reviewed before approval.</li>
            <li id="trustLineC">Account access is only activated after valid payment confirmation.</li>
          </ul>
        </div>
        <div class="trust-card">
          <h4>Release Notes</h4>
          <div class="release-note">
            <strong>Feb 25, 2026:</strong> Added competitive plan catalog, Stripe add-ons, dynamic payment method display, and manual Cash App review request flow.
          </div>
        </div>
      </div>
      <div class="muted" style="margin-top:10px">By continuing, you agree to our <a href="/legal/terms.html" style="color:#35e8ff">Terms</a>, <a href="/legal/privacy.html" style="color:#35e8ff">Privacy</a>, and <a href="/legal/refund.html" style="color:#35e8ff">Refund Policy</a>.</div>
    </section>
  </div>

  <script>
    const API_BASE = String(window.__FRNZ_API_HOST || 'https://api.frenzynets.com').replace(/\/+$/,'');
    let plans = [];
    let addons = [];
    let selected = null;
    let providers = [];
    let referrerCode = '';

    const planCards = document.getElementById('planCards');
    const addonList = document.getElementById('addonList');
    const orderTotal = document.getElementById('orderTotal');
    const planState = document.getElementById('planState');
    const signupState = document.getElementById('signupState');
    const paymentOptions = document.getElementById('paymentOptions');
    const recoveryAssist = document.getElementById('recoveryAssist');
    const geoRec = document.getElementById('geoRec');

    function applySiteConfig(siteConfig){
      const ws = siteConfig && typeof siteConfig === 'object' ? (siteConfig.websiteSettings || {}) : {};
      if (ws.seo?.title) document.title = String(ws.seo.title) + ' | Checkout';
      if (ws.seo?.description) {
        const meta = document.querySelector('meta[name="description"]');
        if (meta) meta.setAttribute('content', String(ws.seo.description));
      }

      const heroTitle = document.getElementById('heroTitle');
      const heroSub = document.getElementById('heroSub');
      if (heroTitle && ws.hero?.title) heroTitle.textContent = String(ws.hero.title);
      if (heroSub && ws.hero?.sub) heroSub.textContent = String(ws.hero.sub);

      const trustLineA = document.getElementById('trustLineA');
      const trustLineB = document.getElementById('trustLineB');
      const trustLineC = document.getElementById('trustLineC');
      if (trustLineA && ws.trust?.uptime) trustLineA.textContent = String(ws.trust.uptime);
      if (trustLineB && ws.trust?.users) trustLineB.textContent = String(ws.trust.users);
      if (trustLineC && ws.trust?.backup) trustLineC.textContent = String(ws.trust.backup);

      const incidentBanner = document.getElementById('incidentBanner');
      if (incidentBanner) {
        const mode = String(ws.incident?.mode || 'off').toLowerCase();
        if (mode !== 'off') {
          incidentBanner.style.display = 'block';
          incidentBanner.textContent = ws.incident?.text || (mode === 'outage' ? 'Service disruption detected. Recovery in progress.' : 'Service is currently degraded. Team is actively stabilizing.');
        } else {
          incidentBanner.style.display = 'none';
        }
      }

      const promoBanner = document.getElementById('promoBanner');
      if (promoBanner) {
        const now = Date.now();
        const rows = Array.isArray(ws.bannerSchedule) ? ws.bannerSchedule : [];
        const active = rows.find(b => {
          const s = Date.parse(String(b.start || ''));
          const e = Date.parse(String(b.end || ''));
          return Number.isFinite(s) && Number.isFinite(e) && now >= s && now <= e;
        });
        if (active && active.text) {
          promoBanner.style.display = 'block';
          promoBanner.textContent = String(active.text);
        } else {
          promoBanner.style.display = 'none';
        }
      }
    }

    async function loadSiteConfig(){
      const endpoints = ['/api/public/site-config', `${API_BASE}/api/public/site-config`];
      for (const ep of endpoints) {
        try {
          const r = await fetch(ep, { cache:'no-store' });
          if (!r.ok) continue;
          const d = await r.json();
          if (d?.siteConfig) {
            applySiteConfig(d.siteConfig);
            return true;
          }
        } catch (_) {}
      }
      return false;
    }

    function providerById(id){
      return providers.find(p=>String(p.id||'').toLowerCase()===String(id||'').toLowerCase()) || null;
    }

    function recommendRegionByTimezone(){
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
      const low = String(tz).toLowerCase();
      if (low.includes('new_york') || low.includes('chicago') || low.includes('los_angeles') || low.includes('denver')) return 'US Priority Node (East/Central/West auto-balance)';
      if (low.includes('london') || low.includes('berlin') || low.includes('paris')) return 'EU Priority Node';
      if (low.includes('tokyo') || low.includes('seoul') || low.includes('singapore')) return 'APAC Priority Node';
      return 'Auto Node Recommendation (best latency path)';
    }

    function saveDraft(){
      try{
        const draft={
          at:new Date().toISOString(),
          user:document.getElementById('suUser').value.trim(),
          plan:selected?selected.code:'',
          addons:getSelectedAddons().map(a=>a.code),
          promo:(document.getElementById('promoCode').value||'').trim()
        };
        localStorage.setItem('frenzy_checkout_draft', JSON.stringify(draft));
      }catch(_){}
    }

    function loadDraftHint(){
      try{
        const raw=localStorage.getItem('frenzy_checkout_draft');
        if(!raw){ recoveryAssist.textContent='No unfinished checkout detected.'; return; }
        const d=JSON.parse(raw);
        const at=Date.parse(String(d.at||''));
        const mins=Number.isFinite(at)?Math.floor((Date.now()-at)/60000):0;
        if(mins>=15){
          recoveryAssist.innerHTML=`Unfinished checkout detected from ${mins} min ago for <strong>${d.user||'unknown user'}</strong>. You can continue now and close the sale.`;
        }else{
          recoveryAssist.textContent='Recent checkout draft detected and auto-saved.';
        }
      }catch(_){
        recoveryAssist.textContent='Recovery state unavailable.';
      }
    }

    function renderPaymentOptions(){
      const stripe = providerById('stripe');
      const cash = providerById('cashapp');
      const stripeBtn = document.getElementById('signupStripeBtn');
      const cashBtn = document.getElementById('signupCashBtn');
      stripeBtn.disabled = !stripe;
      cashBtn.disabled = !cash;
      if (!stripe && !cash) {
        paymentOptions.textContent = 'No payment providers are currently enabled.';
        return;
      }
      const stripeOptions = Array.isArray(stripe?.displayPaymentOptions) ? stripe.displayPaymentOptions : ['Card', 'Apple Pay', 'Google Pay', 'Link', 'Cash App Pay'];
      const active = [];
      if (stripe) active.push(`Stripe: ${stripeOptions.join(', ')}`);
      if (cash) active.push('Cash App (manual review request)');
      paymentOptions.textContent = `Payment options: ${active.join(' | ')}`;
    }

    function money(cents, ccy='USD'){return new Intl.NumberFormat('en-US',{style:'currency',currency:ccy}).format((Number(cents||0))/100)}
    function setPlanState(msg, cls=''){planState.className=`status ${cls}`;planState.textContent=msg||''}
    function setSignupState(msg, cls=''){signupState.className=`status ${cls}`;signupState.textContent=msg||''}

    function getSelectedAddons(){
      const out=[];
      for(const a of addons){
        if(!a._selected) continue;
        const q=Math.max(1, Math.min(Number(a.maxQuantity||1), Number(a._qty||1)));
        out.push({code:a.code, quantity:q, amountCents:Number(a.amountCents||0), currency:a.currency||'USD', name:a.name||a.code});
      }
      return out;
    }

    function calcTotal(){
      if(!selected) return 0;
      const add=getSelectedAddons().reduce((s,a)=>s+(a.amountCents*a.quantity),0);
      return Number(selected.amountCents||0)+add;
    }

    function renderTotal(){
      if(!selected){orderTotal.textContent='Total: --';return}
      orderTotal.textContent=`Total: ${money(calcTotal(), selected.currency||'USD')}`;
    }

    function renderAddons(){
      addonList.innerHTML='';
      if(!addons.length){addonList.innerHTML='<div class="muted">No add-ons configured.</div>'; renderTotal(); return;}
      for(const a of addons){
        const row=document.createElement('div');
        row.className='addon';
        row.innerHTML=`
          <div>
            <strong>${a.name||a.code}</strong>
            <small>${a.description||''}</small>
          </div>
          <div>${money(a.amountCents,a.currency||'USD')}</div>
          <div style="display:flex;gap:6px;align-items:center;">
            <input type="checkbox" ${a._selected?'checked':''} />
            <input class="qty" type="number" min="1" max="${Math.max(1, Number(a.maxQuantity||1))}" value="${Math.max(1, Number(a._qty||1))}" ${a._selected?'':'disabled'} />
          </div>
        `;
        const check=row.querySelector('input[type="checkbox"]');
        const qty=row.querySelector('.qty');
        check.addEventListener('change',()=>{a._selected=check.checked; qty.disabled=!check.checked; renderTotal();});
        qty.addEventListener('input',()=>{a._qty=Number(qty.value||1); renderTotal();});
        addonList.appendChild(row);
      }
      renderTotal();
      saveDraft();
    }

    function applyAddonPack(codes){
      const wanted = new Set((codes || []).map(x=>String(x||'').toLowerCase()));
      for(const a of addons){
        const code = String(a.code||'').toLowerCase();
        a._selected = wanted.has(code);
        if(a._selected) a._qty = 1;
      }
      renderAddons();
    }

    function applyPrefillFromQuery(){
      try{
        const q=new URLSearchParams(location.search);
        const planCode=(q.get('plan')||'').trim().toLowerCase();
        const addonSingle=(q.get('addon')||'').trim().toLowerCase();
        const addonCsv=(q.get('addons')||'').trim().toLowerCase();
        const coupon=(q.get('coupon')||'').trim();
        const ref=(q.get('ref')||'').trim().toLowerCase();
        const wantedAddons=new Set(
          [addonSingle, ...addonCsv.split(',').map(x=>x.trim()).filter(Boolean)]
            .filter(Boolean)
        );

        if(planCode){
          const match=plans.find(p=>String(p.code||'').toLowerCase()===planCode);
          if(match) selected=match;
        }

        if(wantedAddons.size){
          for(const a of addons){
            const code=String(a.code||'').toLowerCase();
            if(wantedAddons.has(code)){
              a._selected=true;
              a._qty=1;
            }
          }
        }

        const user=(q.get('user')||'').trim();
        if(user){
          const box=document.getElementById('suUser');
          if(box) box.value=user;
        }
        if(coupon){
          const c=document.getElementById('promoCode');
          if(c) c.value=coupon;
        }
        if(ref) referrerCode = ref;
      }catch(_){}
    }

    function renderPlans(){
      planCards.innerHTML='';
      if(!plans.length){setPlanState('No plans available right now.','err');return}
      for(const p of plans){
        const el=document.createElement('div');
        el.className='card'+(selected&&selected.code===p.code?' sel':'');
        el.innerHTML=`<div class="tag">${(p.code||'').toUpperCase()}</div><div class="name">${p.name||p.code}</div><div class="price">${money(p.amountCents,p.currency||'USD')}</div><div class="intv">Every ${p.interval||'month'}</div><button type="button" class="choose">Select</button>`;
        el.querySelector('.choose').addEventListener('click',()=>{selected=p; renderPlans(); renderTotal(); setPlanState(`Selected: ${p.name}`,'ok');});
        planCards.appendChild(el);
      }
      if(!selected){selected=plans[0]; renderPlans();}
      saveDraft();
    }

    async function loadCatalog(){
      setPlanState('Loading plans...');
      const res=await fetch(`${API_BASE}/api/billing/providers`,{cache:'no-store'});
      const data=await res.json();
      providers=Array.isArray(data.providers)?data.providers:[];
      plans=Array.isArray(data.plans)?data.plans:[];
      addons=(Array.isArray(data.addons)?data.addons:[]).map(a=>({...a,_selected:false,_qty:1}));
      applyPrefillFromQuery();
      renderPaymentOptions();
      renderPlans();
      renderAddons();
      setPlanState(plans.length?'Plans loaded.':'No plans loaded.', plans.length?'ok':'err');
    }

    function validateSignup(){
      const username=document.getElementById('suUser').value.trim().toLowerCase();
      const password=document.getElementById('suPass').value;
      const confirm=document.getElementById('suPass2').value;
      if(!selected) throw new Error('Please choose a plan.');
      if(!/^[a-z0-9._-]{3,40}$/.test(username)) throw new Error('Username must be 3-40 chars (a-z, 0-9, ., _, -).');
      if(!password||password.length<8) throw new Error('Password must be at least 8 characters.');
      if(password!==confirm) throw new Error('Passwords do not match.');
      return {username,password,planCode:selected.code,addons:getSelectedAddons().map(a=>({code:a.code,quantity:a.quantity})),promoCode:(document.getElementById('promoCode').value||'').trim(),referrer:referrerCode};
    }

    async function signupCheckout(provider){
      try{
        const body=validateSignup();
        if(!providerById(provider)) throw new Error(`${provider} is not available right now.`);
        setSignupState('Creating account and checkout session...');
        const res=await fetch(`${API_BASE}/api/billing/signup-checkout`,{
          method:'POST',headers:{'Content-Type':'application/json'},
          body:JSON.stringify({
            ...body,
            provider,
            addons: provider==='stripe' ? body.addons : [],
            promoCode: body.promoCode || '',
            referrer: body.referrer || '',
            successUrl:`${location.origin}/billing/success.html?plan=${encodeURIComponent(body.planCode)}`,
            cancelUrl:`${location.origin}/billing/cancel.html?plan=${encodeURIComponent(body.planCode)}`
          })
        });
        const data=await res.json();
        if(!res.ok) throw new Error(data.error||'checkout_failed');
        if(data.requiresManualReview||provider==='cashapp'){
          setSignupState(data.reviewMessage||'Cash App request submitted. We will review and approve manually.','ok');
          return;
        }
        if(!data.checkoutUrl) throw new Error('checkout_url_missing');
        setSignupState('Redirecting to secure checkout...','ok');
        localStorage.removeItem('frenzy_checkout_draft');
        location.href=data.checkoutUrl;
      }catch(e){setSignupState(`Signup failed: ${e.message||e}`,'err')}
    }

    document.getElementById('signupStripeBtn').addEventListener('click',()=>signupCheckout('stripe'));
    document.getElementById('signupCashBtn').addEventListener('click',()=>signupCheckout('cashapp'));
    document.getElementById('addonPackCompetitive').addEventListener('click',()=>applyAddonPack(['anti_ddos','premium_presets','anti_spike_guard']));
    document.getElementById('addonPackPremium').addEventListener('click',()=>applyAddonPack(['tournament_priority','dedicated_ip','priority_support','advanced_analytics']));
    document.getElementById('addonPackCreator').addEventListener('click',()=>applyAddonPack(['stream_mode','priority_support','advanced_analytics']));
    document.getElementById('addonPackStreaming').addEventListener('click',()=>applyAddonPack(['adblock_streaming','priority_support']));
    document.getElementById('addonPackClear').addEventListener('click',()=>applyAddonPack([]));
    (() => {
      function track(name){
        try{
          const k='frenzy_track_counts';
          const raw=localStorage.getItem(k);
          const j=raw?JSON.parse(raw):{};
          j[name]=Number(j[name]||0)+1;
          localStorage.setItem(k, JSON.stringify(j));
        }catch(_){}
      }
      document.querySelectorAll('[data-track]').forEach(el=>el.addEventListener('click',()=>track(String(el.getAttribute('data-track')||'unknown'))));
    })();
    document.getElementById('genPromoLink').addEventListener('click',()=>{
      if(!selected){setSignupState('Select a plan before generating promo link.','err'); return;}
      const u=(document.getElementById('suUser').value||'').trim();
      const c=(document.getElementById('promoCode').value||'').trim();
      const url=new URL(location.origin + '/billing/');
      url.searchParams.set('plan', selected.code);
      const a=getSelectedAddons().map(x=>x.code);
      if(a.length) url.searchParams.set('addons', a.join(','));
      if(u) url.searchParams.set('user', u);
      if(c) url.searchParams.set('coupon', c);
      navigator.clipboard.writeText(url.toString()).then(()=>setSignupState('Promo link copied to clipboard.','ok')).catch(()=>setSignupState(url.toString(),'ok'));
      saveDraft();
    });
    document.getElementById('suUser').addEventListener('input', saveDraft);
    document.getElementById('promoCode').addEventListener('input', saveDraft);
    geoRec.textContent = recommendRegionByTimezone();
    loadDraftHint();
    loadSiteConfig().catch(()=>{});
    loadCatalog().catch(err=>setPlanState(`Load failed: ${err.message||err}`,'err'));
  </script>
</body>
</html>
