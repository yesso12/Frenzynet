<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FrenzyNets Watch Party Access</title>
  <style>
    :root {
      --bg:#07111f;
      --panel:#0f1c31;
      --panel-2:#132743;
      --line:#2e4a73;
      --text:#e8f0ff;
      --muted:#9eb4d7;
      --accent:#2bd6ff;
      --ok:#74f0b6;
      --warn:#ffd166;
      --bad:#ff8aa0;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(circle at 20% 20%, #15345a 0, var(--bg) 42%), linear-gradient(145deg, #07111f, #0a1525);
      color:var(--text);
      padding:20px;
    }
    .shell {
      max-width:1080px;
      margin:0 auto;
      background:linear-gradient(160deg, rgba(15,28,49,.96), rgba(9,18,33,.97));
      border:1px solid var(--line);
      border-radius:14px;
      padding:18px;
      box-shadow:0 18px 50px rgba(0,0,0,.35);
    }
    h1,h2,h3 { margin:0 0 10px; }
    p { margin:0 0 10px; }
    .muted { color:var(--muted); }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .btn {
      display:inline-block;
      border:1px solid #4f79ad;
      border-radius:10px;
      padding:10px 14px;
      color:#081422;
      text-decoration:none;
      font-weight:700;
      background:linear-gradient(135deg, #72e7ff, var(--accent));
      cursor:pointer;
    }
    .btn.secondary {
      color:var(--text);
      background:linear-gradient(135deg, #1a3255, #193152);
    }
    .grid {
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:12px;
      margin-top:14px;
    }
    .card {
      background:linear-gradient(155deg, rgba(19,39,67,.95), rgba(12,26,47,.96));
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
    }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:4px; }
    input {
      width:100%;
      border:1px solid #33527d;
      background:#0b1a2e;
      color:var(--text);
      border-radius:10px;
      padding:10px;
      margin-bottom:10px;
    }
    .status { font-size:13px; min-height:18px; margin-top:6px; }
    .status.ok { color:var(--ok); }
    .status.warn { color:var(--warn); }
    .status.bad { color:var(--bad); }
    table { width:100%; border-collapse:collapse; margin-top:8px; font-size:13px; }
    th,td { border-bottom:1px solid #2d466d; padding:8px; text-align:left; }
    th { color:#cfe3ff; font-weight:700; }
    .pill {
      display:inline-block;
      border:1px solid #3f628f;
      border-radius:999px;
      padding:3px 9px;
      font-size:12px;
      color:#b8d6ff;
      margin-right:6px;
    }
    .footer { margin-top:14px; font-size:12px; color:var(--muted); }
    .hidden { display:none !important; }
    @media (max-width:900px) {
      .grid { grid-template-columns:1fr; }
      body { padding:12px; }
      .shell { padding:12px; }
      .btn { width:100%; text-align:center; }
      .row .btn { width:100%; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <h1>FrenzyNets Watch Party Access Center</h1>
    <p class="muted">Relabeled for Watch Party operations. Manage event access, join links, and synced account list in one place.</p>
    <p class="muted" style="margin-bottom:8px">Build: 2026-02-27 09:45 UTC</p>
    <div class="card hidden" id="adminDownloadsCard" style="margin-bottom:10px;border-color:#4b6fa4">
      <h3 style="margin-bottom:6px">Desktop Downloads (Latest Builds)</h3>
      <p class="muted">Use the newest Watch Party desktop build for your device architecture. These packages are self-contained.</p>
      <div class="row">
        <a class="btn" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip">Windows x64</a>
        <a class="btn" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x86.zip">Windows x86</a>
        <a class="btn" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-arm64.zip">Windows ARM64</a>
        <a class="btn secondary" href="/frenzynet-updates/runtime-check.ps1">Runtime Check Script</a>
      </div>
    </div>

    <div class="row hidden" id="adminTopActions" style="margin-top:10px">
      <a class="btn" href="/telewatch/">Open Watch Party</a>
      <a class="btn" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip">Download Latest Desktop (x64)</a>
      <a class="btn secondary" href="https://discord.gg/4uRUSAN498" target="_blank" rel="noopener">Open Discord</a>
      <a class="btn secondary" href="/telewatch/admin/">Open Telewatch Admin</a>
      <a class="btn secondary" href="/status/">Live Status</a>
    </div>
    <div class="card" style="margin-top:10px">
      <h3 style="margin-bottom:6px">Public Access</h3>
      <p class="muted">Desktop control and download options are admin-only for now. Public users can join watch parties from <a href="/telewatch/" style="color:#8fdcff">Telewatch</a>.</p>
    </div>

    <div class="grid">
      <section class="card hidden" id="adminPlatformCard">
        <h2>Platform</h2>
        <p><span class="pill">Channel: stable</span><span class="pill">Watch Party</span></p>
        <p class="muted">Use Telewatch for all rooms, hosting, and one-click Main Event mode. Desktop downloads below are the newest available builds.</p>
        <div class="row" style="margin-top:10px">
          <a class="btn secondary" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x64.zip.sha256">x64 SHA256</a>
          <a class="btn secondary" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-x86.zip.sha256">x86 SHA256</a>
          <a class="btn secondary" href="/frenzynet-updates/FrenzyWatchPartyPanel-win-arm64.zip.sha256">ARM64 SHA256</a>
        </div>
      </section>

      <section class="card">
        <h2>Admin Login Sync</h2>
        <label for="adminUser">Admin Username</label>
        <input id="adminUser" type="email" placeholder="Trimbledustn@gmail.com" />
        <label for="adminPass">Admin Password</label>
        <input id="adminPass" type="password" placeholder="Admin password" />
        <div class="row">
          <button id="loginBtn" class="btn secondary" type="button">Sign In</button>
          <button id="logoutBtn" class="btn secondary" type="button">Sign Out</button>
          <button id="refreshBtn" class="btn secondary" type="button">Refresh Users</button>
        </div>
        <div id="status" class="status warn">Not signed in</div>
      </section>
    </div>

    <section class="card" style="margin-top:12px">
      <h3>User Logins (Auto-Updated)</h3>
      <p class="muted">List refreshes every 20 seconds while signed in. New users appear automatically after they are added in admin tools.</p>
      <div style="overflow:auto">
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Role</th>
              <th>Plan</th>
              <th>Channel</th>
              <th>Subscription</th>
            </tr>
          </thead>
          <tbody id="usersBody">
            <tr><td colspan="5" class="muted">Sign in to load users.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <div class="footer">&copy; 2026 FrenzyNets. All rights reserved. FrenzyNets is a protected brand and service platform.</div>
  </div>

  <script>
    (() => {
      const API_BASES = [
        'https://api.frenzynets.com/api/frenzynet',
        'https://api.frenzynets.com/api'
      ];
      const els = {
        adminUser: document.getElementById('adminUser'),
        adminPass: document.getElementById('adminPass'),
        loginBtn: document.getElementById('loginBtn'),
        logoutBtn: document.getElementById('logoutBtn'),
        refreshBtn: document.getElementById('refreshBtn'),
        status: document.getElementById('status'),
        usersBody: document.getElementById('usersBody'),
        adminDownloadsCard: document.getElementById('adminDownloadsCard'),
        adminTopActions: document.getElementById('adminTopActions'),
        adminPlatformCard: document.getElementById('adminPlatformCard'),
      };
      let token = '';
      let timer = null;

      async function api(path, opts = {}) {
        let lastErr = null;
        for (const base of API_BASES) {
          try {
            const url = base + path;
            const headers = Object.assign({ 'Content-Type': 'application/json' }, opts.headers || {});
            if (token) headers.Authorization = 'Bearer ' + token;
            const res = await fetch(url, {
              method: opts.method || 'GET',
              headers,
              body: opts.body ? JSON.stringify(opts.body) : undefined,
              cache: 'no-store'
            });
            const txt = await res.text();
            let data = {};
            try { data = txt ? JSON.parse(txt) : {}; } catch (_) {}
            if (!res.ok) throw new Error(data.error || ('HTTP ' + res.status));
            return data;
          } catch (err) {
            lastErr = err;
          }
        }
        throw lastErr || new Error('request_failed');
      }

      function setStatus(kind, msg) {
        els.status.className = 'status ' + kind;
        els.status.textContent = msg;
      }

      function renderUsers(rows) {
        const users = Array.isArray(rows) ? rows : [];
        if (!users.length) {
          els.usersBody.innerHTML = '<tr><td colspan="5" class="muted">No users found.</td></tr>';
          return;
        }
        els.usersBody.innerHTML = users.map((u) => {
          const username = String(u.username || '');
          const role = String(u.role || (u.isAdmin ? 'admin' : 'user'));
          const plan = String(u.plan || 'standard');
          const channel = String(u.updateChannel || 'stable');
          const sub = String(u.subscriptionExpiresAt || 'none');
          return '<tr>' +
            '<td>' + esc(username) + '</td>' +
            '<td>' + esc(role) + '</td>' +
            '<td>' + esc(plan) + '</td>' +
            '<td>' + esc(channel) + '</td>' +
            '<td>' + esc(sub) + '</td>' +
          '</tr>';
        }).join('');
      }

      function esc(v) {
        return String(v || '')
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      async function login() {
        const username = String(els.adminUser.value || '').trim().toLowerCase();
        const password = String(els.adminPass.value || '').trim();
        if (!username || !password) {
          setStatus('bad', 'Enter admin username and password.');
          return;
        }
        const d = await api('/api/admin/login', { method: 'POST', body: { username, password } });
        token = String(d.token || '');
        if (!token) throw new Error('admin_token_missing');
        try { localStorage.setItem('fn_admin_token', token); } catch (_) {}
        [els.adminDownloadsCard, els.adminTopActions, els.adminPlatformCard].forEach((el) => { if (el) el.classList.remove('hidden'); });
        setStatus('ok', 'Signed in. Auto-refresh active.');
        await refreshUsers();
        if (timer) clearInterval(timer);
        timer = setInterval(() => { refreshUsers().catch(() => {}); }, 20000);
        try { localStorage.setItem('fn_updates_admin_user', username); } catch (_) {}
      }

      async function refreshUsers() {
        if (!token) {
          renderUsers([]);
          setStatus('warn', 'Not signed in');
          return;
        }
        const d = await api('/api/admin/users');
        renderUsers(d.users || []);
        setStatus('ok', 'Users synced: ' + String((d.users || []).length));
      }

      function logout() {
        token = '';
        try { localStorage.removeItem('fn_admin_token'); } catch (_) {}
        [els.adminDownloadsCard, els.adminTopActions, els.adminPlatformCard].forEach((el) => { if (el) el.classList.add('hidden'); });
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
        renderUsers([]);
        setStatus('warn', 'Signed out');
      }

      els.loginBtn.addEventListener('click', () => { login().catch((e) => setStatus('bad', String(e.message || e))); });
      els.logoutBtn.addEventListener('click', logout);
      els.refreshBtn.addEventListener('click', () => { refreshUsers().catch((e) => setStatus('bad', String(e.message || e))); });

      try {
        const saved = localStorage.getItem('fn_updates_admin_user') || 'Trimbledustn@gmail.com';
        if (saved) els.adminUser.value = saved;
      } catch (_) {
        els.adminUser.value = 'Trimbledustn@gmail.com';
      }
      try {
        const existing = localStorage.getItem('fn_admin_token');
        if (existing) {
          token = existing;
          [els.adminDownloadsCard, els.adminTopActions, els.adminPlatformCard].forEach((el) => { if (el) el.classList.remove('hidden'); });
          refreshUsers().catch(() => {});
        }
      } catch (_) {}
    })();
  </script>
</body>
</html>
